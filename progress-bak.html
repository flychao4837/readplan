<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="yes" name="apple-touch-fullscreen">
    <meta content="telephone=no,email=no" name="format-detection">
    
    <meta content="我的进度及评分" name="description" />
    <meta content="" name="author" />
    <title>我的进度及评分</title>
    <script type="text/javascript" src="js/flexible_css.js"></script>
    <script type="text/javascript" src="js/flexible.js"></script>

    <link href="css/reset.css" rel="stylesheet" type="text/css"/>
    <link href="css/main.css" rel="stylesheet" type="text/css"/>
    <link href="css/uiDialog.css" rel="stylesheet" type="text/css"/>
</head>
<body>
    <div class="content content-myinfo hide">
        <a class="goback"></a>
        <div class="user">
            <div class="fz_0 textcenter">
                <div class="user_img">
                    <img src="image/user_head.png">
                </div>
            </div>
            <img class="medal" src="image/medal.png" />
            <p class="textcenter user_name">段全鑫</p>
            <p class="read-total">坚持了<span class="days">XXXXXXX</span>天，累计朗读了<span class="minutes">76</span>分钟</p>
        </div>

        <div class="progress-box">
            <div class="row">
                <div class="col-3">
                    <div class="processingbar1">
                        <svg width="140" height="140" viewbox="0 0 140 140">
                            <circle id="base" cx="70" cy="70" r="60" stroke-width="10" stroke="#D1D3D7" fill="none"></circle>
                            <circle id="progress" cx="70" cy="70" r="60" stroke-width="10" stroke="#00A5E0" fill="none" transform="matrix(0,-1,1,0,0,140)" stroke-dasharray="0 1069"></circle>
                        </svg>
                        <div class="text-info textcenter">
                            <p class="font-warning num">10</p>
                            <p>本</p>
                        </div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="processingbar2">
                        <svg width="278" height="278" viewbox="0 0 278 278">
                            <circle id="base" cx="139" cy="139" r="129" stroke-width="10" stroke="#D1D3D7" fill="none"></circle>
                            <circle id="progress" cx="139" cy="139" r="129" stroke-width="10" stroke="#00A5E0" fill="none" transform="matrix(0,-1,1,0,0,278)" stroke-dasharray="0 1069"></circle>
                        </svg>
                        <div class="text-info textcenter">
                            <div class="slogn">
                                <img src="image/slogn.png" />
                            </div>
                            <p class="num font-warning">66分</p>
                        </div>
                    </div>
                </div>
                <div class="col-3">
                    <div class="processingbar3">
                        <svg width="140" height="140" viewbox="0 0 140 140">
                            <circle id="base" cx="70" cy="70" r="60" stroke-width="10" stroke="#D1D3D7" fill="none"></circle>
                            <circle id="progress" cx="70" cy="70" r="60" stroke-width="10" stroke="#00A5E0" fill="none" transform="matrix(0,-1,1,0,0,140)" stroke-dasharray="0 1069"></circle>
                        </svg>
                        <div class="text-info textcenter">
                            <p class="font-warning num">3250</p>
                            <p>字</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="progress-list">
            <p class="start-time">开始时间：XXXXXXXX</p>
            <div class="list">
                <div class="list-item">
                    <div class="box">
                        <div class="week-name">
                            第五周
                        </div>
                        <div class="boxflex">
                            <p class="font-warning textright">任务开始时间：2017年4月15日 20：00</p>
                        </div>
                    </div>
                </div>
                <div class="list-item">
                    <div class="box">
                        <div class="week-name">
                            第四周
                        </div>
                        <div class="boxflex">
                            <p class="font-warning textright">-3分</p>
                        </div>
                    </div>
                </div>
                <div class="list-item">
                    <div class="box">
                        <div class="week-name">
                            第三周
                        </div>
                        <div class="boxflex">
                            <p class="font-warning textright">5分</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="footer">
        <div class="row">
            <div class="col-6 tab tab-home">
                <a class="btn" href="home.html" target="_self">
                    <div class="box">
                        <span class="icon icon-yd "></span>
                        <p class="boxflex">朗读者计划</p>
                    </div>
                </a>
            </div>
            <div class="col-6 tab tab-my active">
                <a class="btn" href="my.html" target="_self">
                    <div class="box">
                        <span class="icon icon-my"></span>
                        <p class="boxflex">我的</p>
                    </div>
                </a>
            </div>
        </div>
    </div>
</body>
</html>
<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="js/uiDialog.js"></script>
<script type="text/javascript">
$(function(){
    var dialog = new Dialog();
    
    $(".goback").on("click" ,function(){
        history.go(-1);
    });
    var dom = $(".content-myinfo");
    /*评分及进度*/
    function initProgress(a,b,c ,d,e,f){
        var num = 66;// 百分制
        var r = 60; //圆半径
        var r2 = 129;
        var percent1 = a / d ||0;
        var percent2 = b / e ||0;
        var percent3 = c / f ||0;
        var  perimeter = Math.PI * 2 * r;
        var perimeter2 = Math.PI * 2 * r2;
        
        $(".processingbar1 #progress")[0].setAttribute('stroke-dasharray', perimeter * percent1 + " " + perimeter * (1- percent1));
        $(".processingbar2 #progress")[0].setAttribute('stroke-dasharray', perimeter2 * percent2 + " " + perimeter2 * (1- percent2));
        $(".processingbar3 #progress")[0].setAttribute('stroke-dasharray', perimeter * percent3 + " " + perimeter * (1- percent3));

        var rate = parseInt($("html").css("font-size"))
        var size = rate*1.8666666666666667;
        $(".processingbar1>svg,.processingbar3>svg").attr({width:size,height:size});
        $(".processingbar1 .text-info .num").html(a);
        $(".processingbar3 .text-info .num").html(c)

        var size2 = rate*3.7066666666666666;
        $(".processingbar2>svg").attr({width:size2,height:size2});
        $(".processingbar2 .text-info .num").html(b+"分");
    }
    
    /*获取数据*/
    dialog.tip("正在获取数据");
    $.ajax({
        url: 'http://marky.ngrok.cc/learn/my',
        type: 'GET',
        dataType: 'jsonp',
        data:{},
    })
    .done(function(res) {
        if(res.code=="0"){
            console.log(res);
            var data = res.data;
            if(!$.isEmptyObject(data)){
                dom.find(".user_img").attr(data.my.headimgurl);
                dom.find(".user_name").html(data.my.name);
                dom.find(".minutes").html(data.my.duration);

                dom.find(".start-time").html("开始时间："+data.my.start_date);
                dom.find(".days").html(data.my.hold);
                initProgress(data.my_books.num ,data.my_books.duration , data.my_books.words ,data.books.num ,data.books.duration , data.books.words);
                var tmp=""
                //TODO  itmes字段名字拼错
                for(var i in data.itmes){
                    var item = data.itmes[i];
                    tmp+='<div class="list-item"><div class="box"><div class="week-name">'+item.title+'</div><div class="boxflex"><p class="font-warning textright">'+item.description+'</p></div></div></div>'
                }
                dom.find(".list").html(tmp);
                dialog.destroy();
                dom.fadeIn(600);
            }else{
                dialog.tip({'msg':"用户数据错误","time":1600});
            }
        }else{
            dialog.tip({'msg':"用户数据获取失败","time":1600});
        }
        
        dom.fadeIn(600)
    })
    .fail(function() {
        dialog.tip({'msg':"用户数据获取失败","time":1600});
    })
})
</script>
